@model Application.ViewModels.OccupiedRoom.CompoundOccupiedRoomViewModel

@{
    Layout = null;
}

<div class="row">
    <div class="col-md-12">
        <form asp-action="AddOrEdit" asp-route-id="@Model.OccupiedRoomDetailViewModel.Id" onsubmit="return jQueryAjaxPost(this);">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <input type="hidden" asp-for="OccupiedRoomDetailViewModel.Id" />
            <input type="hidden" asp-for="OccupiedRoomDetailViewModel.CustomerId" />
            <input type="hidden" asp-for="OccupiedRoomDetailViewModel.RoomId" />
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        @Html.DisplayNameFor(model => model.OccupiedRoomDetailViewModel.RoomNumber)
                        @Model.OccupiedRoomDetailViewModel.RoomNumber
                    </div>
                    <div class="form-group">
                        @Html.DisplayNameFor(model => model.OccupiedRoomDetailViewModel.RoomTypeName)
                        @Model.OccupiedRoomDetailViewModel.RoomTypeName
                    </div>
                    <div class="form-group">
                        @Html.DisplayNameFor(model => model.OccupiedRoomDetailViewModel.CustomerName)
                        @Model.OccupiedRoomDetailViewModel.CustomerName
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        @Html.DisplayNameFor(model => model.OccupiedRoomDetailViewModel.BeginDate)
                        @Model.OccupiedRoomDetailViewModel.BeginDate.ToString("yyyy-MM-dd")
                    </div>
                    <div class="form-group">
                        @Html.DisplayNameFor(model => model.OccupiedRoomDetailViewModel.EndDate)
                        @Model.OccupiedRoomDetailViewModel.EndDate.ToString("yyyy-MM-dd")
                    </div>
                    <div class="form-group">
                        @Html.DisplayNameFor(model => model.OccupiedRoomDetailViewModel.Expense)
                        @Model.OccupiedRoomDetailViewModel.Expense
                    </div>
                </div>
            </div>
            <hr />
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group row">
                        <label asp-for="OccupiedRoomDetailViewModel.CheckInDate" class="control-label col-sm-3"></label>
                        <div class="col-sm-9">
                            <input asp-for="OccupiedRoomDetailViewModel.CheckInDate" class="form-control" />
                            <span asp-validation-for="OccupiedRoomDetailViewModel.CheckInDate" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group row">
                        <label asp-for="OccupiedRoomDetailViewModel.CheckOutDate" class="control-label col-sm-3"></label>
                        <div class="col-sm-9">
                            <input asp-for="OccupiedRoomDetailViewModel.CheckOutDate" class="form-control" />
                            <span asp-validation-for="OccupiedRoomDetailViewModel.CheckOutDate" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="form-group row">
                        <label asp-for="OccupiedRoomDetailViewModel.Pay" class="control-label col-sm-3 col-form-label"></label>
                        <div class="col-sm-9">
                            <input asp-for="OccupiedRoomDetailViewModel.Pay" class="form-control" readonly />
                            <span asp-validation-for="OccupiedRoomDetailViewModel.Pay" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <input type="submit" value="儲存" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>
@*<script>
        $(function () {

            getAllRoomType('@Model.OccupiedRoomDetailViewModel.RoomTypeId');

            $("#OccupiedRoomDetailViewModel_RoomTypeId").on("change", function () {
                let roomTypeId = $(this).val();

                getAllRoomType(roomTypeId);
                getRoom(roomTypeId);
                getReservationExpense();
            });

            $("#OccupiedRoomDetailViewModel_BeginDate").on("change", function () {
                console.log($(this).val());
                getReservationExpense();
            });

            $("#OccupiedRoomDetailViewModel_EndDate").on("change", function () {
                console.log($(this).val());
                getReservationExpense();
            });
        });

        getReservationExpense = () => {
            const model = {
                BeginDate: $("#OccupiedRoomDetailViewModel_BeginDate").val(),
                EndDate: $("#OccupiedRoomDetailViewModel_EndDate").val(),
                RoomTypeId: $("#OccupiedRoomDetailViewModel_RoomTypeId option:selected").val()
            };

            console.log(model);

            const options = {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(model)
            }

            fetch("/Reservation/GetExpense", options)
                .then(res => res.json())
                .catch(error => console.error("Error:", error))
                .then(data => {
                    console.log("Success:", data);
                    $("#OccupiedRoomDetailViewModel_Expense").val(data.result.expense);
                    $("#OccupiedRoomDetailViewModel_Days").val(data.result.days);
                });
        }



        getAllRoomType = (roomTypeId) => {
            fetch(`/Reservation/GetRoomType/${roomTypeId}`)
                .then(function (response) {
                    return response.json();
                })
                .catch(error => console.error("Error:", error))
                .then(function (data) {

                    let array = [];

                    if (data.result !== "") {
                        array.push(data.result.price);
                        array.push(data.result.hprice);
                        array.push(data.result.area);
                        array.push(data.result.bedQuantity);
                    }
                    else {
                        array = Array(5).fill("");
                    }

                    $("#content").html(`<div class="d-flex flex-column">
                                            <div class="mx-sm-2"><strong>平日價：</strong>${array[0]}</div>
                                            <div class="mx-sm-2"><strong>假日價：</strong>${array[1]}</div>
                                            <div class="mx-sm-2"><strong>房間面積：</strong>${array[2]}</div>
                                            <div class="mx-sm-2"><strong>配備床數：</strong>${array[3]}</div>
                                        </div>`);
                });
        }

        getRoom = (roomTypeId) => {
            fetch(`/Reservation/GetRoom/${roomTypeId}`)
                .then(function (response) {
                    return response.json();
                })
                .catch(error => console.error("Error:", error))
                .then(function (data) {
                    console.log(data);

                    $("#OccupiedRoomDetailViewModel_RoomId").empty();

                    let items = "<option value=''>請選擇</option>";
                    $.each(data.result, function (i, room){
                        items +=`<option value=${room.id}>${room.roomNumber}</option>`
                    });
                    $("#OccupiedRoomDetailViewModel_RoomId").html(items);
                });
        }
    </script>*@
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
